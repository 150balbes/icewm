PACKAGE = @PACKAGE@
VERSION = @VERSION@
HOSTOS  = @HOSTOS@
HOSTCPU = @HOSTCPU@

LOCDIR = @LOCDIR@
DOCDIR = @DOCDIR@

################################################################################

CXX =           @CXX@
LD =            @CXX_LINK@
EXEEXT =        @EXEEXT@

DEBUG =         @DEBUG@
GCCDEP =        @GCCDEP@
DEFS =          @DEFS@ \
                -DLIBDIR='"$(LIBDIR)"' \
                -DCFGDIR='"$(CFGDIR)"' \
                -DLOCDIR='"$(LOCDIR)"' \
                -DKDEDIR='"$(KDEDIR)"' \
                -DPACKAGE='"icewm"' \
                -DVERSION='"$(VERSION)"' \
                -DHOSTOS='"$(HOSTOS)"' \
                -DHOSTCPU='"$(HOSTCPU)"' \
                -DEXEEXT='"$(EXEEXT)"' \
                -DICEWMEXE='"icewm$(EXEEXT)"' \
                -DICEHELPEXE='"icehelp$(EXEEXT)"' \
                -DICEHELPIDX='"$(DOCDIR)/icewm-$(VERSION)/icewm.html"'

CXXFLAGS =      @CXXFLAGS@ $(DEBUG) $(DEFS) \
	        @CORE_CFLAGS@ @IMAGE_CFLAGS@ @AUDIO_CFLAGS@ @GNOME_CFLAGS@
LFLAGS =
LIBS =          @LIBS@

CORE_LIBS =     @CORE_LIBS@
IMAGE_LIBS =    @IMAGE_LIBS@
AUDIO_LIBS =    @AUDIO_LIBS@
GNOME_LIBS =    @GNOME_LIBS@

################################################################################

libice_OBJS = \
        yapp.o ytimer.o ywindow.o ypaint.o ytooltip.o ypopup.o \
        ymenu.o ymenuitem.o yscrollbar.o ybutton.o ylistbox.o yinput.o \
        misc.o icons.o ycursor.o ylabel.o yscrollview.o ysocket.o \
        wmconfig.o ypaths.o ypixbuf.o ylocale.o yarray.o

genpref$(EXEEXT)_OBJS = \
	genpref.o

icewm$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS) $(GNOME_LIBS)
icewm$(EXEEXT)_OBJS = \
        ymsgbox.o ydialog.o yurl.o \
        wmsession.o wmwinlist.o wmtaskbar.o wmwinmenu.o \
        wmdialog.o wmabout.o wmswitch.o wmstatus.o \
        wmoption.o wmaction.o \
        wmcontainer.o wmclient.o \
        wmmgr.o wmapp.o \
        wmframe.o wmbutton.o wmminiicon.o wmtitle.o movesize.o \
        themes.o decorate.o gnome.o browse.o \
        wmprog.o ymenufile.o ydesktop.o yparser.o \
        atasks.o aworkspaces.o amailbox.o aclock.o acpustatus.o \
	apppstatus.o aaddressbar.o objbar.o aapm.o atray.o ysmapp.o \
        $(libice_OBJS)

icesh$(EXEEXT)_LIBS = \
	$(CORE_LIBS)
icesh$(EXEEXT)_OBJS = \
	icesh.o misc.o

icewmhint$(EXEEXT)_LIBS = \
	$(CORE_LIBS)
icewmhint$(EXEEXT)_OBJS = \
	icewmhint.o

icewmbg$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
icewmbg$(EXEEXT)_OBJS = \
	icewmbg.o $(libice_OBJS)

icesound$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(AUDIO_LIBS)
icesound$(EXEEXT)_OBJS = \
	icesound.o misc.o ycmdline.o

icehelp$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
icehelp$(EXEEXT)_OBJS = \
	$(libice_OBJS) icehelp.o

iceclock$(EXEEXT)_OBJS = \
	$(libice_OBJS) iceclock.o aclock.o
iceclock$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
icebar$(EXEEXT)_OBJS = \
	$(libice_OBJS) \
        wmtaskbar.o \
        wmprog.o gnome.o browse.o themes.o wmaction.o \
	amailbox.o aclock.o acpustatus.o apppstatus.o aaddressbar.o objbar.o
icesame$(EXEEXT)_OBJS = \
	$(libice_OBJS) icesame.o
icesame$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
icelist$(EXEEXT)_OBJS = \
	$(libice_OBJS) icelist.o
icelist$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
iceview$(EXEEXT)_OBJS = \
	$(libice_OBJS) iceview.o
iceview$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
iceicon$(EXEEXT)_OBJS = \
	$(libice_OBJS) iceicon.o
iceicon$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
icerun$(EXEEXT)_OBJS = \
	$(libice_OBJS) icerun.o
icerun$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
iceskt$(EXEEXT)_OBJS = \
	$(libice_OBJS) iceskt.o

testwinhints$(EXEEXT)_OBJS= \
        testwinhints.o
testwinhints$(EXEEXT)_LIBS = \
        $(CORE_LIBS) $(IMAGE_LIBS)

testnetwmhints$(EXEEXT)_OBJS= \
        testnetwmhints.o
testnetwmhints$(EXEEXT)_LIBS = \
        $(CORE_LIBS) $(IMAGE_LIBS)

testlocale$(EXEEXT)_OBJS = \
	testlocale.o ylocale.o misc.o
testdesktop$(EXEEXT)_OBJS = \
	testdesktop.o ydesktop.o yparser.o ylocale.o misc.o
testdesktop$(EXEEXT)_LIBS = \
	$(CORE_LIBS) $(IMAGE_LIBS)
testgnomevfs$(EXEEXT)_OBJS = \
	testgnomevfs.o gnomevfs.o ylibrary.o misc.o
testgnomevfs$(EXEEXT)_LFLAGS = \
        -ldl
testarray$(EXEEXT)_OBJS = \
	testarray.o yarray.o misc.o

################################################################################

APPLICATIONS = @APPLICATIONS@
TESTCASES = @TESTCASES@
OBJECTS = @BASEOBJS@ @TESTOBJS@
BINARIES = @BASEBINS@ @TESTBINS@

################################################################################

all: base
base: @BASEBINS@ ../lib/preferences
tests: @TESTBINS@
clean:
	rm -f $(BINARIES) *.o *.d *~

.PHONY: all base tests clean

################################################################################

#%.p: %.cc
#	@echo Analysing dependencies for $^...
#	@$(CXX) $(CXXFLAGS) -M -c $< > $@

%.o: %.cc
	@echo Compiling $@...
	@$(CXX) $(CXXFLAGS) $(GCCDEP) -c $<
	
################################################################################

$(BINARIES):
	@echo Linking $@...
	@$(LD) -o $@ $($@_OBJS) $(LFLAGS) $($@_LFLAGS) $(LIBS) $($@_LIBS)

libice.so: $(libice_OBJS)
	-@rm -f $@
	ld -shared -o $@ $(libice_OBJS)

wmabout.o: ../VERSION

../lib/preferences: genpref
	./genpref >../lib/preferences

################################################################################

