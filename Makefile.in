################################################################################
# GNU make should only be needed in maintainer mode now
################################################################################
# Please run 'configure' first (generate it with autogen.sh)
################################################################################

PACKAGE = @PACKAGE@
VERSION = @VERSION@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
sysconfdir = @sysconfdir@
libdatadir = @libdatadir@
cfgdatadir = @cfgdatadir@
localedir = @localedir@
kdedatadir = @kdedatadir@

PREFIX = $(exec_prefix)
BINDIR = $(bindir)
LIBDIR = $(libdatadir)
CFGDIR = $(cfgdatadir)
LOCDIR = $(localedir)
KDEDIR = $(kdedatadir)
DOCDIR = $(docdir)
GWMDIR = @GWMDIR@

INSTALL    = @INSTALL@
INSTALLDIR = @INSTALLDIR@
INSTALLBIN = @INSTALLBIN@
INSTALLLIB = @INSTALLLIB@
INSTALLETC = @INSTALLETC@

DESTDIR     =
MKFONTDIR   =

################################################################################

BINFILES    = @BINFILES@
LIBFILES    = lib/preferences lib/menu lib/toolbar lib/winoptions lib/keys
DOCFILES    = README TODO CHANGES COPYING AUTHORS FAQ INSTALL VERSION icewm.lsm
XPMDIRS     = icons ledclock taskbar mailbox cursors
THEMES      = nice motif win95 warp3 warp4 metal2 gtk2 Infadel2
SPEC        = icewm.spec
LSM         = icewm.lsm

GNOMEFILES  = lib/IceWM.desktop

all:		@TARGETS@
install:	@TARGETS_INSTALL@

depend base icesound icehelp:
	@cd src; $(MAKE) $@ LIBDIR=$(LIBDIR) CFGDIR=$(CFGDIR)

docs:
	@cd src; $(MAKE) all

nls:
	@cd po; $(MAKE) all

gnome:

srcclean:
	@cd src; $(MAKE) clean

clean:  srcclean
	@cd doc; $(MAKE) clean

distclean: clean
	rm -f *~ config.cache config.log config.status install.inc \
	sysdep.inc src/config.h lib/preferences


maintainer-clean: distclean
	rm -f $(SPEC) $(LSM) Makefile configure src/config.h.in
	@cd doc; $(MAKE) maintainer-clean

dist:	$(SPEC) $(LSM) distclean docs depend configure

configure: configure.in
	aclocal
	autoconf
	autoheader

$(SPEC): $(SPEC).in VERSION
	sed  <$< >$@ \
	    -e "s|@@VERSION@@|$(VERSION)|g"

$(LSM): $(LSM).in VERSION
	sed <$< >$@ \
	    -e "s|@@VERSION@@|$(VERSION)|g" \
	    -e "s|@@DATE@@|`date +%d%b%Y | tr 'a-z' 'A-Z'`|"

# Makefile TABS *SUCK*
install-base: base
	@echo ------------------------------------------
	@echo "Installing binaries in $(DESTDIR)$(BINDIR)"
	@$(INSTALLDIR) $(DESTDIR)$(BINDIR)
	@for app in $(BINFILES) ; do \
            $(INSTALLBIN) "$$app" $(DESTDIR)$(BINDIR); \
        done
	@echo "Installing defaults, icons and themes in $(DESTDIR)$(LIBDIR)"
	@$(INSTALLDIR) $(DESTDIR)$(LIBDIR)
	@$(INSTALLDIR) $(DESTDIR)$(CFGDIR)
	@for lib in $(LIBFILES) ; do \
            $(INSTALLLIB) "$$lib" $(DESTDIR)$(LIBDIR); \
        done
	@for xpmdir in $(XPMDIRS); do \
	    if test -d lib/$$xpmdir; then \
		$(INSTALLDIR) $(DESTDIR)$(LIBDIR)/$$xpmdir; \
		for pixmap in lib/$$xpmdir/*.xpm ; do \
		    $(INSTALLLIB) "$$pixmap" $(DESTDIR)$(LIBDIR)/$$xpmdir; \
		done; \
	    fi; \
        done
	@echo ------------------------------------------
	@for theme in $(THEMES) ; do \
            echo "Installing theme: $$theme"; \
            $(INSTALLDIR) $(DESTDIR)$(LIBDIR)/themes/$$theme; \
            for pixmap in lib/themes/$$theme/*.xpm; do \
                $(INSTALLLIB) "$$pixmap" $(DESTDIR)$(LIBDIR)/themes/$$theme; \
            done; \
            for subtheme in lib/themes/$$theme/*.theme; do \
                $(INSTALLLIB) "$$subtheme" $(DESTDIR)$(LIBDIR)/themes/$$theme; \
            done; \
	    if test -f lib/themes/$$theme/*.pcf; then \
                for fontfile in lib/themes/$$theme/*.pcf; do \
		    $(INSTALLLIB) "$$fontfile" $(DESTDIR)$(LIBDIR)/themes/$$theme; \
		done; \
		if test "$(MKFONTDIR)" != "" -a -x "$(MKFONTDIR)"; then \
		  (cd "$(DESTDIR)$(LIBDIR)/themes/$$theme"; $(MKFONTDIR)) ; \
		else \
		  echo "WARNING: A dummy file has been copied to"; \
		  echo "         $(DESTDIR)$(LIBDIR)/themes/$$theme/fonts.dir"; \
		  echo "         You better setup your path to point to mkfontdir or use the"; \
		  echo "         --with-mkfontdir option of the configure script."; \
		  $(INSTALLLIB) "$(DESTDIR)/lib/themes/$$theme/fonts.dir.default" \
				"$(DESTDIR)$(LIBDIR)/themes/$$theme/fonts.dir"; \
		fi; \
	    fi; \
            for xpmdir in $(XPMDIRS) ; do \
                if [ -d lib/themes/$$theme/$$xpmdir ] ; then \
                    $(INSTALLDIR) $(DESTDIR)$(LIBDIR)/themes/$$theme/$$xpmdir; \
                    for f in lib/themes/$$theme/$$xpmdir/*.xpm ; do \
                        $(INSTALLLIB) "$$f" $(DESTDIR)$(LIBDIR)/themes/$$theme/$$xpmdir; \
                    done;\
                fi;\
            done;\
        done
#@for a in $(ETCFILES) ; do $(INSTALLETC) "$$a" $(CFGDIR) ; done
	@echo ------------------------------------------

install-docs: docs $(LSM)
	@echo ------------------------------------------
	@rm -fr $(DESTDIR)$(DOCDIR)/icewm-$(VERSION)
	@$(INSTALLDIR) $(DESTDIR)$(DOCDIR)/icewm-$(VERSION)
	@echo Installing documentation in $(DESTDIR)$(DOCDIR); \
	cp $(DOCFILES) $(DESTDIR)$(DOCDIR)/icewm-$(VERSION); \
	cp -r doc/*.sgml doc/*.html $(DESTDIR)$(DOCDIR)/icewm-$(VERSION)
	@echo ------------------------------------------

install-nls: nls
	@echo ------------------------------------------
	@cd po; $(MAKE) install
	@echo ------------------------------------------

install-gnome: gnome
	@echo ------------------------------------------
	@echo Installing icewm-gnome in $(DESTDIR)$(GWMDIR)
	@$(INSTALLDIR) $(DESTDIR)$(GWMDIR)
	@$(INSTALLLIB) lib/IceWM.desktop $(DESTDIR)$(GWMDIR)
	@echo ------------------------------------------
